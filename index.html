<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KisanConnect — Login</title>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial;
      background:#fafafa;color:#262626;
      display:flex;align-items:center;justify-content:center;padding:20px;height:100vh;
    }
    .card{
      width:100%;max-width:380px;background:#fff;border:1px solid #dbdbdb;
      border-radius:8px;padding:28px;box-shadow:0 1px 3px rgba(0,0,0,0.04)
    }
    .logo{
      font-family: 'Pacifico', cursive;
      font-size:36px;text-align:center;margin-bottom:18px
    }
    .sub{color:#8e8e8e;text-align:center;font-size:14px;margin-bottom:18px}
    input{
      width:100%;padding:10px 12px;border-radius:4px;border:1px solid #dbdbdb;
      background:#fafafa;font-size:14px;margin-bottom:10px
    }
    .btn{
      padding:10px;border-radius:4px;border:0;background:#3897f0;
      color:white;font-weight:600;cursor:pointer;margin-top:5px
    }
    .fb{color:#385185;font-weight:600;text-align:center;margin:10px 0;cursor:pointer}
    .small{text-align:center;color:#8e8e8e;font-size:13px;margin-top:10px}
    .or{
      display:flex;align-items:center;margin:14px 0;color:#8e8e8e;font-size:13px
    }
    .or::before,.or::after{
      content:"";flex:1;height:1px;background:#dbdbdb;margin:0 10px
    }
    .hidden{display:none}
    .error{color:#e74c3c;text-align:center;font-size:13px;margin-bottom:10px}
  </style>
</head>

<body>

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <div class="logo">KisanConnect</div>
    <div class="sub">Login to manage your mandi rates and listings</div>

    <div id="error" class="error hidden"></div>

    <!-- PHONE LOGIN ONLY -->
    <input id="phoneInput" placeholder="Enter phone number (e.g. 9876543210)" />
    <button id="phoneSendOtp" class="btn">Send OTP</button>

    <div class="or"><span>OR</span></div>

    <div id="emailOption" class="fb">Continue with Email</div>
    <div id="googleBtn" class="fb">Continue with Google</div>

    <div class="signup small">
      Don’t have an account? <a href="#" id="showSignup">Sign up</a>
    </div>
  </div>

  <!-- OTP BOX -->
  <div class="card hidden" id="otpBox">
    <div class="sub">Enter OTP</div>
    <input id="otpInside" placeholder="Enter OTP" />
    <button id="verifyOtp" class="btn">Verify OTP</button>
    <div id="otpError" class="error hidden"></div>
  </div>

  <!-- EMAIL LOGIN FORM -->
  <div class="card hidden" id="emailCard">
    <div class="sub">Login with Email</div>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button id="emailLoginBtn" class="btn">Log In</button>
  </div>

  <!-- SIGNUP -->
  <div class="card hidden" id="signupCard">
    <div class="sub">Create account</div>
    <input id="sname" placeholder="Full Name" />
    <input id="semail" type="email" placeholder="Email" />
    <input id="spassword" type="password" placeholder="Password (6+ chars)" />
    <button id="signupBtn" class="btn">Sign Up</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getAuth, signInWithEmailAndPassword, GoogleAuthProvider,
      signInWithPopup, createUserWithEmailAndPassword, updateProfile,
      RecaptchaVerifier, signInWithPhoneNumber
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCNTk8Albrx2RgaBuQ45GNDEiOSDIwSZX4",
      authDomain: "kisan-922e0.firebaseapp.com",
      projectId: "kisan-922e0",
      storageBucket: "kisan-922e0.firebasestorage.app",
      messagingSenderId: "445867146442",
      appId: "1:445867146442:web:5ebb15443157b09f370833"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const $ = id => document.getElementById(id);

    function showError(msg, box="error"){
      $(box).textContent = msg;
      $(box).classList.remove("hidden");
      setTimeout(()=>$(box).classList.add("hidden"),3000);
    }

    // Invisible reCAPTCHA
    const recaptcha = new RecaptchaVerifier(auth, "phoneSendOtp", { size:"invisible" });

    let confirmationResult = null;

    // SEND OTP
    $("phoneSendOtp").addEventListener("click", async ()=>{
      let num = $("phoneInput").value.trim();
      if(num.length !== 10) return showError("Enter valid 10 digit number");

      num = "+91" + num;
      try{
        confirmationResult = await signInWithPhoneNumber(auth, num, recaptcha);
        $("loginCard").classList.add("hidden");
        $("otpBox").classList.remove("hidden");
      }catch(e){
        showError(e.message);
      }
    });

    // VERIFY OTP
    $("verifyOtp").addEventListener("click", async ()=>{
      try{
        await confirmationResult.confirm($("otpInside").value);
        alert("Login Successful!");
      }catch(e){
        showError(e.message, "otpError");
      }
    });

    // GOOGLE LOGIN
    $("googleBtn").addEventListener("click", async ()=>{
      try{
        await signInWithPopup(auth, new GoogleAuthProvider());
        alert("Login Successful!");
      }catch(e){ showError(e.message); }
    });

    // EMAIL LOGIN UI
    $("emailOption").onclick = ()=>{
      $("loginCard").classList.add("hidden");
      $("emailCard").classList.remove("hidden");
    }

    // EMAIL LOGIN
    $("emailLoginBtn").onclick = async ()=>{
      try{
        await signInWithEmailAndPassword(auth, $("email").value, $("password").value);
        alert("Login Successful!");
      }catch(e){ showError(e.message); }
    }

    // SIGNUP
    $("showSignup").onclick = ()=>{
      $("loginCard").classList.add("hidden");
      $("signupCard").classList.remove("hidden");
    }

    $("signupBtn").onclick = async ()=>{
      try{
        const r = await createUserWithEmailAndPassword(auth, $("semail").value, $("spassword").value);
        updateProfile(r.user, { displayName: $("sname").value });
        alert("Signup Done!");
      }catch(e){ showError(e.message); }
    }
  </script>

</body>
</html>
